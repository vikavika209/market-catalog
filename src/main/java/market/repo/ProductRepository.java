package market.repo;

import market.domain.Product;

import java.io.IOException;
import java.util.List;
import java.util.Optional;

/**
 * Репозиторий для управления объектами {@link Product}.
 * <p>
 * Определяет абстрактный интерфейс доступа к хранилищу данных (например, в памяти, в файле или в БД).
 * Реализация отвечает за сохранение, загрузку и поиск товаров, а также за генерацию новых идентификаторов.
 * <p>
 * Данный слой изолирует бизнес-логику от конкретной технологии хранения данных.
 */
public interface ProductRepository {
    /**
     * Сохраняет товар в хранилище.
     * <p>
     * Если товар уже существует (по идентификатору), он обновляется;
     * если идентификатор отсутствует — создаётся новый.
     *
     * @param p товар для сохранения
     * @return сохранённый объект {@link Product} (с актуальным идентификатором)
     */
    Product save(Product p);

    /**
     * Ищет товар по его идентификатору.
     *
     * @param id идентификатор товара
     * @return {@link Optional} с найденным товаром или {@link Optional#empty()},
     * если товар с таким идентификатором не найден
     */
    Optional<Product> findById(long id);

    /**
     * Удаляет товар по идентификатору.
     *
     * @param id идентификатор товара
     * @return {@code true}, если товар был успешно удалён;
     * {@code false}, если товар с таким идентификатором не найден
     */
    boolean deleteById(long id);

    /**
     * Возвращает все товары, хранящиеся в репозитории.
     *
     * @return список всех товаров (может быть пустым, но не {@code null})
     */
    List<Product> findAll();

    /**
     * Генерирует новый уникальный идентификатор для создаваемого товара.
     *
     * @return следующий уникальный идентификатор
     */
    long nextId();

    /**
     * Загружает данные товаров из внешнего источника (например, CSV-файла).
     *
     * @throws IOException если произошла ошибка при чтении данных
     */
    void load() throws IOException;

    /**
     * Сохраняет текущее состояние данных в постоянное хранилище.
     *
     * @throws IOException если произошла ошибка при записи данных
     */
    void flush() throws IOException;
}
